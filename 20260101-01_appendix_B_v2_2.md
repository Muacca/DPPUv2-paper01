# 付録B：再現性と検証

本付録では、計算結果の再現性を担保するため、(B.1) 計算エンジンの仕様、(B.2) 自動検証（サニティチェック）の一覧をまとめる。

コードへのアクセス情報については、付録F を参照。

---

## B.1 計算エンジンの仕様

### B.1.1 エンジン構成

DPPUv2 Engine Core v3.0 は、Einstein-Cartan + Nieh-Yan 理論の minisuperspace 縮約を記号計算で実行する Python ベースのエンジンである。

**アーキテクチャ**：

```
BaseFrameEngine (抽象基底クラス)
    │
    ├── S3S1Engine    (S³×S¹ 実装)
    ├── T3S1Engine    (T³×S¹ 実装)
    └── Nil3S1Engine  (Nil³×S¹ 実装)
```

各トポロジー固有の実装は、構造定数 $C^i{}_{jk}$ とメトリックの設定（Step E4.1–E4.2）のみを担当し、それ以降の計算ロジック（Step E4.3–E4.15）は基底クラスで共通化されている。


### B.1.2 計算パイプライン

エンジンは以下の15ステップを順次実行する：

| Step | 名称 | 内容 |
|:----:|:-----|:-----|
| E4.1 | Setup | パラメータ記号の定義、トポロジー固有の初期化 |
| E4.2 | Metric & Frame | Frame metric $\eta_{ab}$ と coframe $e^a$ の設定 |
| E4.3 | Christoffel | 一般 Koszul 公式による Levi-Civita 接続の計算 |
| E4.4 | Torsion Ansatz | Mode に応じた torsion テンソル $T^a{}_{bc}$ の構成 |
| E4.5 | Contortion | Contortion $K^a{}_{bc}$ の計算 |
| E4.6 | EC Connection | Einstein-Cartan 接続 $\omega^{a}{}_{bc} = \Gamma^{a}{}_{bc} + K^{a}{}_{bc}$ |
| E4.7 | Riemann Tensor | EC 接続からの Riemann テンソル計算 + 反対称性検証 |
| E4.8 | Ricci Scalar | Ricci スカラー $R$ の導出 |
| E4.9 | Torsion Scalar | Torsion スカラー $T_{abc}T^{abc}$ の計算 |
| E4.10 | Nieh-Yan | NY 密度 $N_{\text{TT}}$, $N_{\text{REE}}$, $N_{\text{FULL}}$ の計算 |
| E4.11 | Lagrangian | $\mathcal{L} = R/(2\kappa^2) + \theta_{NY} N$ の構成 |
| E4.12 | Integration | 角度積分による有効作用の導出 |
| E4.13 | Potential | 有効ポテンシャル $V_{\text{eff}}(r) = -S_{\text{eff}}$ の抽出 |
| E4.14 | Stability | 安定性解析（極値探索、Type 分類） |
| E4.15 | Summary | 結果のまとめと出力 |


### B.1.3 Mode と NY Variant

**Torsion Mode**（Enum: `Mode`）

| Mode | 記号 | T1（軸性） | T2（ベクトル） | パラメータ |
|:----:|:----:|:---------:|:-------------:|:----------|
| AX | Axial-only | ✓ | — | $\eta$ のみ |
| VT | Vector-only | — | ✓ | $V$ のみ |
| MX | Mixed | ✓ | ✓ | $(\eta, V)$ |

本論文の主要結果は MX mode に基づく。AX/VT は各成分の寄与を切り分けるための診断に使用。

**NY Variant**（Enum: `NyVariant`）

| Variant | 採用する NY 密度 | 定義 |
|:-------:|:----------------|:-----|
| TT | $N_{\text{TT}}$ | $\frac{1}{4}\varepsilon^{abcd} T^{e}{}_{ab} T_{ecd}$ |
| REE | $N_{\text{REE}}$ | $\frac{1}{4}\varepsilon^{abcd} R_{abcd}$ |
| FULL | $N_{\text{FULL}} = N_{\text{TT}} - N_{\text{REE}}$ | 完全 NY 密度 |


### B.1.4 記号計算ライブラリ

エンジンは SymPy を用いた完全記号計算を実行する。主要な使用機能：

- `sympy.tensor.array.MutableDenseNDimArray`：テンソル表現
- `sympy.simplify`, `sympy.factor`, `sympy.together`：式の簡約化
- `sympy.lambdify`：数値評価用関数の生成

数値計算（パラメータスキャン）については、付録C を参照。

---

## B.2 サニティチェック一覧

計算の整合性を保証するため、エンジンは以下の自動検証を各ステップで実行する。

### B.2.1 メトリック互換性検証（Step E4.3）

Levi-Civita 接続がメトリック互換であることを検証：

#### (式 B.1)

$$
\Gamma_{abc} + \Gamma_{bac} = 0 \quad \text{（直交正規 frame の場合）}
$$

全ての $(a, b, c)$ 組み合わせについて記号的に検証し、違反があれば計算を停止する。

**実装**：
```python
def _verify_metric_compatibility(self):
    for a, b, c in itertools.product(range(dim), repeat=3):
        check = simplify(Gamma[a,b,c] + Gamma[b,a,c])
        if check != 0:
            raise ValueError("Metric compatibility violated")
```


### B.2.2 Riemann テンソル反対称性検証（Step E4.7）

Riemann テンソルの反対称性を **3段階の厳密検証** で確認する：

#### (式 B.2)

$$
R_{abcd} = -R_{bacd}, \quad R_{abcd} = -R_{abdc}
$$

**検証レベル**：

| レベル | 判定 | 方法 |
|:-----:|:-----|:-----|
| 1 | PROVED_ZERO | 記号的簡約化により $R_{abcd} + R_{bacd} = 0$ を証明 |
| 2 | WITNESS_NONZERO | 数値的反例（witness）の探索により非ゼロを検出 |
| 3 | UNPROVED | 記号的証明も反例も見つからない（警告） |

**記号的証明パイプライン**：
```
simplify → expand → factor → cancel → together → trigsimp → combined
```

各段階で $= 0$ が得られれば PROVED_ZERO として通過。

**数値的 witness 探索**：

記号的証明に失敗した場合、ランダムなパラメータ点で数値評価を行い、非ゼロの値が得られれば WITNESS_NONZERO として違反を報告。多倍長精度演算（mpmath, 50桁）を使用して数値誤差を排除。


### B.2.3 Torsion テンソル構造検証（Step E4.4）

Torsion ansatz が指定された Mode と整合することを確認：

- AX mode： $T^{\mu} = T^{\lambda}{}_{\mu\lambda} = 0$ （ベクトルトレースがゼロ）
- VT mode： $S^{\mu} = \varepsilon^{\mu\nu\rho\sigma} T_{\nu\rho\sigma} = 0$ （軸性成分がゼロ）
- MX mode：両成分が非ゼロ


### B.2.4 NY 密度の整合性検証（Step E4.10）

3つの NY 密度間の関係を検証：

#### (式 B.3)

$$
N_{\text{FULL}} = N_{\text{TT}} - N_{\text{REE}}
$$

記号的に等式が成立することを確認。


### B.2.5 既知結果との比較

**$S^3 \times S^1$ の Levi-Civita 接続**：

$SU(2)$ 左不変 frame における接続成分は解析的に既知：

#### (式 B.4)

$$
\Gamma^0{}_{12} = -\Gamma^0{}_{21} = \frac{2}{r}, \quad \text{etc.}
$$

エンジン出力がこれらの値と一致することを確認済み。

**$T^3 \times S^1$ の平坦性**：

背景 Levi-Civita 曲率がゼロ（$R^{\text{LC}}_{abcd} = 0$）となることを検証。

**$Nil^3$ の構造定数**：

Milnor の公式に基づく構造定数：

#### (式 B.5)

$$
C^0{}_{12} = C^0{}_{21} = -\frac{1}{r}
$$

がエンジン設定と一致することを確認。

---

## B.3 検証結果のサマリー

本論文の全計算（3トポロジー × 3 mode × 3 variant = 27構成）について、以下の検証が完了している：

| 検証項目 | $S^3 \times S^1$ | $T^3 \times S^1$ | $Nil^3 \times S^1$ |
|:--------|:---------------:|:---------------:|:-----------------:|
| メトリック互換性 | ✓ PASS | ✓ PASS | ✓ PASS |
| Riemann 反対称性 (ab) | ✓ PROVED | ✓ PROVED | ✓ PROVED |
| Riemann 反対称性 (cd) | ✓ PROVED | ✓ PROVED | ✓ PROVED |
| NY 密度整合性 | ✓ PASS | ✓ PASS | ✓ PASS |
| 既知結果との比較 | ✓ 一致 | ✓ 一致 | ✓ 一致 |

検証ログは各 runner の実行時に自動生成され、`{Topology}_{Mode}_{Variant}_{timestamp}.log` として保存される。

本論文で用いた検証ログへのアクセスについては付録F を参照。


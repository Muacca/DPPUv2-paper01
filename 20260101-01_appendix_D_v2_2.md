# 付録D：可視化ツール

本付録では、相図の探索と $V_{\text{eff}}(r)$ の可視化を行うためのインタラクティブツールについて説明する。読者はこのツールを用いて、本文で提示した以外のパラメータ領域を自由に探索し、結果を再現・拡張することができる。

なお、コードへのアクセスおよび実行する上で必要になるものの情報については、付録F を参照。

---

## D.1 インタラクティブ可視化ノートブックの概要

### D.1.1 機能一覧

インタラクティブビューアーは以下の機能を提供する：

**構成選択**
- トポロジー切替： $S^3 \times S^1$ 、 $T^3 \times S^1$ 、 $Nil^3 \times S^1$
- Torsion モード：MX（混合）、AX（軸性のみ）、VT（ベクトルのみ）
- NY variant：FULL、TT、REE
- $T^3$ 非等方性パラメータ： $\alpha = R_2/R_1$ 、 $\beta = R_3/R_1$

**相図表示**
- $(V, \eta)$ 平面上の Type I/II/III 分類
- $\theta_{NY}$ スライダーによるリアルタイム更新

**ポテンシャルプロット**
- 相図上のクリックによる点選択（最大3点同時表示）
- $V_{\text{eff}}(r)$ の形状比較
- 軸スケール切替（線形 / 対数 / symlog）
- 表示範囲の動的調整

### D.1.2 提供ファイル

| ファイル名 | 説明 |
|:----------|:-----|
| `DPPUv2_visualize_notebook_v3.ipynb` | Jupyter Notebook（メインインターフェース） |
| `DPPUv2_interactive_viewer_v3.py` | インタラクティブビューアー本体 |

詳細なファイル一覧は付録F.1 を参照。

### D.1.3 キャッシュ機構

計算エンジンは SymPy による記号計算を実行するため、初回の関数生成に数秒を要する。ビューアーはキャッシュ機構を実装しており、一度生成したポテンシャル関数は再利用される。

キャッシュキーの構造：
- $S^3$ 、 $Nil^3$ ：`(topology, mode, ny_variant)`
- $T^3$ ：`(topology, mode, ny_variant, α, β)`

$T^3$ では非等方性パラメータ $(\alpha, \beta)$ を変更するたびに新しい関数が生成される。

---

## D.2 使用方法

### D.2.1 基本的な起動手順

1. 全ファイルを同一ディレクトリに配置
2. Jupyter Notebook を起動
3. `DPPUv2_visualize_notebook_v3.ipynb` を開く
4. セルを実行

```python
%matplotlib widget
from DPPUv2_interactive_viewer_v3 import DPPUv2InteractiveViewer
viewer = DPPUv2InteractiveViewer()
viewer.display()
```


### D.2.2 スライダー範囲のカスタマイズ

デフォルトのスライダー範囲を変更する場合は、インスタンス生成前にクラス変数を設定する：

```python
# 相図の η 範囲を拡張
DPPUv2InteractiveViewer.SLIDER_ETA_MIN_MIN = -30.0
DPPUv2InteractiveViewer.SLIDER_ETA_MAX_MAX = 30.0

# ポテンシャルプロットの r 範囲を拡張
DPPUv2InteractiveViewer.SLIDER_R_MAX_DEFAULT = 1000.0

viewer = DPPUv2InteractiveViewer()
viewer.display()
```

利用可能なクラス変数：

| 変数名 | デフォルト値 | 説明 |
|:------|:-----------:|:-----|
| `SLIDER_V_MAX_MIN` | 1.0 | $V_{\max}$ スライダーの下限 |
| `SLIDER_V_MAX_MAX` | 50.0 | $V_{\max}$ スライダーの上限 |
| `SLIDER_V_MAX_DEFAULT` | 10.0 | $V_{\max}$ の初期値 |
| `SLIDER_ETA_MIN_MIN` | -50.0 | $\eta_{\min}$ スライダーの下限 |
| `SLIDER_ETA_MIN_DEFAULT` | -15.0 | $\eta_{\min}$ の初期値 |
| `SLIDER_ETA_MAX_MAX` | 50.0 | $\eta_{\max}$ スライダーの上限 |
| `SLIDER_ETA_MAX_DEFAULT` | 5.0 | $\eta_{\max}$ の初期値 |
| `SLIDER_R_MAX_DEFAULT` | 100.0 | $r_{\max}$ の初期値 |


### D.2.3 操作方法

**相図の生成**
1. Configuration パネルでトポロジー、モード、variant を選択
2. $\theta_{NY}$ スライダーを調整
3. "Draw Phase Diagram" ボタンをクリック

**ポテンシャルの比較**
1. 相図上の任意の点をクリック（Point 1 として登録）
2. Point Selection で "Point 2" を選択し、別の点をクリック
3. 右パネルに最大3点の $V_{\text{eff}}(r)$ が重ねて表示される

**$T^3$ 非等方性の探索**
1. トポロジーで "T3" を選択
2. Anisotropy パネルが表示される
3. $\alpha$ 、 $\beta$ スライダーで非等方比を調整
4. 相図を再描画

---

## D.3 生成可能な図表

ビューアーを用いて以下の図表を生成できる：

### D.3.1 任意の $\theta_{NY}$ スライスの相図

本文では $\theta_{NY} = 0, 1, 2$ を提示したが、ビューアーでは $\theta_{NY} \in [0, 5]$ の任意の値でスライスを生成できる。これにより、相境界の連続的変化を確認できる。

### D.3.2 任意のパラメータ点の $V_{\text{eff}}(r)$

相図上の任意の点をクリックすることで、その $(V, \eta)$ における有効ポテンシャルの形状を即座に確認できる。Type I/II/III の分類がプロットラベルに表示される。

### D.3.3 TT/REE variant の比較

NY variant を切り替えることで、FULL、TT、REE の相図を比較できる。これにより、本文 Sec. 7.2 で議論した曲率結合の役割を視覚的に確認できる。

### D.3.4 $T^3$ 非等方性の効果

$\alpha \neq 1$ または $\beta \neq 1$ に設定することで、非等方トーラスにおける相構造の変化を探索できる。本文 Appendix E で議論した体積リスケール不変性の検証にも使用できる。

